<!DOCTYPE html>
<html>
  <head>
    <title>Programming Challenge: DOM</title>
    <script type="text/javascript">
      async function loadXMLDoc(docURL) {
        let doc = await fetch(docURL);
        let response = await doc.text();
        let xml = new DOMParser().parseFromString(response, "text/xml");
        return xml;
      }

      function createNameSection(currentCard) {
        var nameSection = document.createElement("div");
        nameSection.setAttribute("class", "Name");
        var nameStr = document.createTextNode(
          currentCard.getElementsByTagName("Name")[0].firstChild.data
        );
        nameSection.appendChild(nameStr);
        return nameSection;
      }

      function createEmailSection(currentCard) {
        var emailSection = document.createElement("div");
        emailSection.setAttribute("class", "email");
        var emailStr = document.createTextNode(
          currentCard.getElementsByTagName("email")[0].firstChild.data
        );
        emailSection.appendChild(emailStr);
        return emailSection;
      }

      function createPhoneSection(currentCard) {
        var phones = currentCard.getElementsByTagName("phone");

        var phoneSection = document.createElement("div");
        for (var j = 0; j < phones.length; j++) {
          newPhone = document.createElement("div");
          newPhone.setAttribute("class", "phone");
          var labelStr =
            currentCard.getElementsByTagName("phone")[j].getAttribute("type") +
            ": ";
          var phoneStr = document.createTextNode(
            labelStr +
              currentCard.getElementsByTagName("phone")[j].firstChild.data
          );
          newPhone.appendChild(phoneStr);
          phoneSection.appendChild(newPhone);
        }

        return phoneSection;
      }

      function createCardElements() {
        // YOUR CODE GOES HERE
        loadXMLDoc("businesscard.xml").then((xmlData) => {
          var bizCard = xmlData.getElementsByTagName("BusinessCard");

          // loop over the tags and create a new <div> to
          // each card along with the info for all fields

          for (var i = 0; i < bizCard.length; i++) {
            var currentCard = bizCard[i]; //store a reference to the current <BusinessCard>
          }

          // make a new <div> for the whole card
          var newCard = document.createElement("div");
          newCard.setAttribute("class", "BusinessCard");

          // now create a <div> for the name
          var newName = createNameSection(currentCard);
          newCard.appendChild(newName);

          // create a <div> for the email
          var newEmail = createEmailSection(currentCard);
          newCard.appendChild(newEmail);

          // create a <div> for the phone
          var newPhone = createPhoneSection(currentCard);
          newCard.append(newPhone);

          document.getElementById("cardContainer").appendChild(newCard);
        });
      }

      window.addEventListener("load", function () {
        document
          .getElementById("createCard")
          .addEventListener("click", createCardElements);
      });
    </script>
    <link rel="stylesheet" href="businesscard.css" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <button id="createCard">Create Business Card Elements</button>
    <div id="cardContainer"></div>
  </body>
</html>
